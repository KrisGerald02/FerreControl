<?xml version="1.0" encoding="UTF-8"?>

<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd"
              name="FacturaDetalle" language="java"
              pageWidth="595" pageHeight="842" columnWidth="555"
              leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20">

    <!-- Parámetros - los mismos que envía PrintInvoiceAction -->
    <parameter name="numeroFactura"    class="java.lang.String"/>
    <parameter name="fecha"            class="java.util.Date"/>
    <parameter name="clienteNombre"    class="java.lang.String"/>
    <parameter name="clienteCedula"    class="java.lang.String"/>
    <parameter name="clienteDireccion" class="java.lang.String"/>
    <parameter name="clienteTelefono"  class="java.lang.String"/>
    <parameter name="metodoPago"       class="java.lang.String"/>

    <parameter name="subtotal"         class="java.math.BigDecimal"/>
    <parameter name="iva"              class="java.math.BigDecimal"/>
    <parameter name="total"            class="java.math.BigDecimal"/>

    <!-- Campos del detalle (DetalleFactura) -->
    <field name="productoNombre"     class="java.lang.String"/>
    <field name="cantidad"           class="java.math.BigDecimal"/>
    <field name="precio"             class="java.math.BigDecimal"/>
    <field name="descuentoPorcentaje" class="java.math.BigDecimal"/>
    <field name="importe"            class="java.math.BigDecimal"/>

    <background>
        <band/>
    </background>

    <!-- ENCABEZADO -->
    <title>
        <band height="250">

            <!-- Fondo superior -->
            <rectangle>
                <reportElement x="0" y="0" width="555" height="100"
                               backcolor="#EEEEEE" mode="Opaque"/>
            </rectangle>

            <!-- Logo -->
            <image>
                <reportElement x="20" y="15" width="60" height="60"/>
                <imageExpression class="java.lang.String"><![CDATA["C:/Users/intim/Downloads/logo_ferreteria.jpg"]]></imageExpression>
            </image>

            <!-- Nombre ferretería -->
            <staticText>
                <reportElement x="100" y="25" width="350" height="24"/>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font size="18" isBold="true"/>
                </textElement>
                <text><![CDATA[Ferretería Vanessa]]></text>
            </staticText>

            <!-- Subtítulo -->
            <staticText>
                <reportElement x="100" y="49" width="350" height="18"/>
                <textElement textAlignment="Center">
                    <font size="11" isItalic="true"/>
                </textElement>
                <text><![CDATA[Factura por su compra]]></text>
            </staticText>

            <!-- Ubicación -->
            <staticText>
                <reportElement x="100" y="72" width="70" height="12"/>
                <textElement>
                    <font size="9" isBold="true"/>
                </textElement>
                <text><![CDATA[Ubicación:]]></text>
            </staticText>
            <staticText>
                <reportElement x="170" y="72" width="260" height="12"/>
                <textElement>
                    <font size="8"/>
                </textElement>
                <text><![CDATA[La Dalia, Matagalpa (De la Alcaldía de la Dalia media cuadra arriba)]]></text>
            </staticText>

            <!-- Teléfono -->
            <staticText>
                <reportElement x="100" y="86" width="70" height="12"/>
                <textElement>
                    <font size="9" isBold="true"/>
                </textElement>
                <text><![CDATA[Teléfono:]]></text>
            </staticText>
            <staticText>
                <reportElement x="170" y="86" width="120" height="12"/>
                <textElement>
                    <font size="9"/>
                </textElement>
                <text><![CDATA[+505 8624 4743]]></text>
            </staticText>

            <!-- Número de factura -->
            <staticText>
                <reportElement x="0" y="110" width="140" height="14"/>
                <textElement>
                    <font size="9" isBold="true"/>
                </textElement>
                <text><![CDATA[Número de factura:]]></text>
            </staticText>
            <textField>
                <reportElement x="140" y="110" width="180" height="14"/>
                <textElement>
                    <font size="9"/>
                </textElement>
                <textFieldExpression><![CDATA[$P{numeroFactura}]]></textFieldExpression>
            </textField>

            <!-- Fecha -->
            <staticText>
                <reportElement x="370" y="110" width="50" height="14"/>
                <textElement textAlignment="Right">
                    <font size="9" isBold="true"/>
                </textElement>
                <text><![CDATA[Fecha:]]></text>
            </staticText>
            <textField pattern="dd/MM/yyyy">
                <reportElement x="425" y="110" width="110" height="14"/>
                <textElement>
                    <font size="9"/>
                </textElement>
                <textFieldExpression><![CDATA[$P{fecha}]]></textFieldExpression>
            </textField>

            <!-- Cliente -->
            <staticText>
                <reportElement x="0" y="128" width="80" height="14"/>
                <textElement>
                    <font size="9" isBold="true"/>
                </textElement>
                <text><![CDATA[Cliente:]]></text>
            </staticText>
            <textField>
                <reportElement x="80" y="128" width="455" height="14"/>
                <textElement>
                    <font size="9"/>
                </textElement>
                <textFieldExpression><![CDATA[$P{clienteNombre} + " (" + $P{clienteCedula} + ")"]]></textFieldExpression>
            </textField>

            <!-- Dirección -->
            <staticText>
                <reportElement x="0" y="146" width="80" height="14"/>
                <textElement>
                    <font size="9" isBold="true"/>
                </textElement>
                <text><![CDATA[Dirección:]]></text>
            </staticText>
            <textField isStretchWithOverflow="true">
                <reportElement x="80" y="146" width="455" height="28"/>
                <textElement>
                    <font size="9"/>
                </textElement>
                <textFieldExpression><![CDATA[$P{clienteDireccion}]]></textFieldExpression>
            </textField>

            <!-- Teléfono cliente -->
            <staticText>
                <reportElement x="0" y="176" width="80" height="14"/>
                <textElement>
                    <font size="9" isBold="true"/>
                </textElement>
                <text><![CDATA[Teléfono:]]></text>
            </staticText>
            <textField>
                <reportElement x="80" y="176" width="200" height="14"/>
                <textElement>
                    <font size="9"/>
                </textElement>
                <textFieldExpression><![CDATA[$P{clienteTelefono}]]></textFieldExpression>
            </textField>

            <!-- Método de pago -->
            <staticText>
                <reportElement x="0" y="194" width="100" height="14"/>
                <textElement>
                    <font size="9" isBold="true"/>
                </textElement>
                <text><![CDATA[Método de pago:]]></text>
            </staticText>
            <textField>
                <reportElement x="100" y="194" width="200" height="14"/>
                <textElement>
                    <font size="9"/>
                </textElement>
                <textFieldExpression><![CDATA[$P{metodoPago}]]></textFieldExpression>
            </textField>

            <!-- Línea separadora -->
            <line>
                <reportElement x="0" y="215" width="555" height="1" forecolor="#CCCCCC"/>
            </line>

            <!-- Cabecera de columnas -->
            <staticText>
                <reportElement x="0" y="225" width="255" height="15"/>
                <textElement textAlignment="Left" verticalAlignment="Middle">
                    <font size="9" isBold="true"/>
                </textElement>
                <text><![CDATA[Descripción]]></text>
            </staticText>

            <staticText>
                <reportElement x="255" y="225" width="60" height="15"/>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font size="9" isBold="true"/>
                </textElement>
                <text><![CDATA[Cant.]]></text>
            </staticText>

            <staticText>
                <reportElement x="315" y="225" width="60" height="15"/>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font size="9" isBold="true"/>
                </textElement>
                <text><![CDATA[Desc %]]></text>
            </staticText>

            <staticText>
                <reportElement x="375" y="225" width="80" height="15"/>
                <textElement textAlignment="Right" verticalAlignment="Middle">
                    <font size="9" isBold="true"/>
                </textElement>
                <text><![CDATA[Precio]]></text>
            </staticText>

            <staticText>
                <reportElement x="455" y="225" width="100" height="15"/>
                <textElement textAlignment="Right" verticalAlignment="Middle">
                    <font size="9" isBold="true"/>
                </textElement>
                <text><![CDATA[Importe]]></text>
            </staticText>

        </band>
    </title>

    <!-- DETALLE -->
    <detail>
        <band height="18">

            <line>
                <reportElement x="0" y="17" width="555" height="1" forecolor="#EEEEEE"/>
            </line>

            <textField>
                <reportElement x="0" y="2" width="255" height="14"/>
                <textElement verticalAlignment="Middle">
                    <font size="8"/>
                </textElement>
                <textFieldExpression><![CDATA[$F{productoNombre}]]></textFieldExpression>
            </textField>

            <textField>
                <reportElement x="255" y="2" width="60" height="14"/>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font size="8"/>
                </textElement>
                <textFieldExpression><![CDATA[$F{cantidad}]]></textFieldExpression>
            </textField>

            <textField pattern="#0.##' %'">
                <reportElement x="315" y="2" width="60" height="14"/>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font size="8"/>
                </textElement>
                <textFieldExpression><![CDATA[$F{descuentoPorcentaje} == null ? java.math.BigDecimal.ZERO : $F{descuentoPorcentaje}]]></textFieldExpression>
            </textField>

            <textField pattern="C$ #,##0.00">
                <reportElement x="375" y="2" width="80" height="14"/>
                <textElement textAlignment="Right" verticalAlignment="Middle">
                    <font size="8"/>
                </textElement>
                <textFieldExpression><![CDATA[$F{precio}]]></textFieldExpression>
            </textField>

            <textField pattern="C$ #,##0.00">
                <reportElement x="455" y="2" width="100" height="14"/>
                <textElement textAlignment="Right" verticalAlignment="Middle">
                    <font size="8"/>
                </textElement>
                <textFieldExpression><![CDATA[$F{importe}]]></textFieldExpression>
            </textField>

        </band>
    </detail>

    <!-- RESUMEN: SUBTOTAL, IVA, TOTAL -->
    <summary>
        <band height="80">

            <line>
                <reportElement x="0" y="0" width="555" height="1" forecolor="#CCCCCC"/>
            </line>

            <!-- Mensaje -->
            <staticText>
                <reportElement x="0" y="10" width="300" height="15"/>
                <textElement>
                    <font size="9" isItalic="true"/>
                </textElement>
                <text><![CDATA[Gracias por su compra. ¡Vuelva pronto!]]></text>
            </staticText>

            <!-- Subtotal -->
            <staticText>
                <reportElement x="345" y="10" width="110" height="15"/>
                <textElement textAlignment="Right">
                    <font size="9"/>
                </textElement>
                <text><![CDATA[Subtotal:]]></text>
            </staticText>
            <textField pattern="C$ #,##0.00">
                <reportElement x="455" y="10" width="100" height="15"/>
                <textElement textAlignment="Right">
                    <font size="9"/>
                </textElement>
                <textFieldExpression><![CDATA[$P{subtotal}]]></textFieldExpression>
            </textField>

            <!-- IVA -->
            <staticText>
                <reportElement x="345" y="27" width="110" height="15"/>
                <textElement textAlignment="Right">
                    <font size="9"/>
                </textElement>
                <text><![CDATA[IVA (15%):]]></text>
            </staticText>
            <textField pattern="C$ #,##0.00">
                <reportElement x="455" y="27" width="100" height="15"/>
                <textElement textAlignment="Right">
                    <font size="9"/>
                </textElement>
                <textFieldExpression><![CDATA[$P{iva}]]></textFieldExpression>
            </textField>

            <!-- Total -->
            <staticText>
                <reportElement x="345" y="47" width="110" height="18"/>
                <textElement textAlignment="Right" verticalAlignment="Middle">
                    <font size="10" isBold="true"/>
                </textElement>
                <text><![CDATA[Monto total:]]></text>
            </staticText>
            <textField pattern="C$ #,##0.00">
                <reportElement x="455" y="47" width="100" height="18"/>
                <textElement textAlignment="Right" verticalAlignment="Middle">
                    <font size="10" isBold="true"/>
                </textElement>
                <textFieldExpression><![CDATA[$P{total}]]></textFieldExpression>
            </textField>

        </band>
    </summary>

</jasperReport>
